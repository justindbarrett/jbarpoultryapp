<!-- Show button only for inspectors when no initials exist -->
<ion-button
  *ngIf="isInspector && !hasInitials"
  [expand]="buttonExpand"
  [color]="buttonColor"
  [disabled]="disabled"
  (click)="openModal()"
  shape="round"
  size="small"
  style="
    white-space: normal;
    height: auto;
    min-height: 36px;
    line-height: 1.3;
    padding: 8px 16px;
  "
>
  {{ buttonText }}
</ion-button>

<!-- Show "Inspector Initials Needed" for non-inspectors when no initials exist -->
<div *ngIf="!isInspector && !hasInitials" style="padding-top: 8px">
  <ion-text style="color: #999; font-style: italic">
    Inspector Initials Needed
  </ion-text>
</div>

<!-- Show initials and time for all roles when they exist -->
<div
  *ngIf="hasInitials"
  style="
    padding-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  "
>
  <ion-text style="font-size: 1em; color: #666">
    {{ displayTime }}
  </ion-text>
  <ion-text style="font-size: 1.1em">
    <strong>{{ fsisInitial }}</strong>
  </ion-text>
</div>

<ion-modal
  [isOpen]="isModalOpen"
  [initialBreakpoint]="0.5"
  [breakpoints]="[0, 0.5, 0.75]"
  (didDismiss)="cancel()"
>
  <ng-template>
    <ion-content class="ion-padding">
      <div style="max-width: 400px; margin: 0 auto; padding: 20px 10px">
        <h2 style="text-align: center; margin-bottom: 20px; margin-top: 0">
          Confirm FSIS Initial
        </h2>

        <div *ngIf="loading" style="text-align: center; padding: 40px">
          <ion-spinner color="primary"></ion-spinner>
          <p>Loading initials...</p>
        </div>

        <div *ngIf="!loading">
          <div style="text-align: center; margin-bottom: 30px">
            <p style="font-size: 0.9em; color: #666; margin-bottom: 8px">
              <strong>Inspector Initials</strong>
            </p>
            <p
              style="
                font-size: 2em;
                color: #3880ff;
                font-weight: bold;
                letter-spacing: 3px;
                margin: 0;
              "
            >
              {{ activeInitials }}
            </p>
          </div>

          <div style="text-align: center; margin-bottom: 30px">
            <p style="font-size: 0.9em; color: #666; margin-bottom: 8px">
              <strong>Ante Mortem Time</strong>
            </p>
            <p style="font-size: 1.5em; color: #333; margin: 0">
              {{ formattedTime }}
            </p>
          </div>

          <ion-button
            expand="block"
            color="primary"
            shape="round"
            [disabled]="loading"
            (click)="confirm()"
            style="margin-bottom: 10px"
          >
            Confirm
          </ion-button>
          <ion-button
            expand="block"
            color="medium"
            fill="outline"
            shape="round"
            (click)="cancel()"
          >
            Cancel
          </ion-button>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
